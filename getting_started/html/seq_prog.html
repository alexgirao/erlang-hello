<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- This document was generated using DocBuilder-0.9.8.4 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Sequential Programming</title>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
  <script type="text/javascript" src="../../doc/erlresolvelinks.js"></script>
  <style type="text/css">
<!--
    body          { font-family: Verdana, Arial, Helvetica, sans-serif }
    span.bold_code        { font-family: courier;font-weight: bold}
    span.code        { font-family: courier;font-weight: normal}

.note, .warning {
  border: solid black 1px;
  margin: 1em 3em;
}

.note .label {
  background: #30d42a;
  color: white;
  font-weight: bold;
  padding: 5px 10px;
}
.note .content {
  background: #eafeea;
  color: black;
  line-height: 120%;
  font-size: 90%;
  padding: 5px 10px;
}
.warning .label {
  background: #C00;
  color: white;
  font-weight: bold;
  padding: 5px 10px;
}
.warning .content {
  background: #FFF0F0;
  color: black;
  line-height: 120%;
  font-size: 90%;
  padding: 5px 10px;
}

    .example     { background-color:#eeeeff } 
    pre          { font-family: courier; font-weight: normal }
    .REFBODY     { margin-left: 13mm }
    .REFTYPES    { margin-left: 8mm }
-->
  </style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#FF00FF" alink="#FF0000">
<center>
<a href="http://www.ericsson.com/technology/opensource/erlang"><img border="0" alt="[Ericsson AB]" src="min_head.gif"/></a>
</center><a name="2"><!-- Empty --></a>
<h2>2 Sequential Programming</h2>
<a name="2.1"><!-- Empty --></a>
<h3>2.1 The Erlang Shell</h3>

<p>Most operating systems have a command interpreter or shell, Unix
and Linux have many, Windows has the Command Prompt. Erlang has
its own shell where you can directly write bits of Erlang code
and evaluate (run) them to see what happens (see
<a href="javascript:erlhref('../../', 'stdlib', 'shell.html');">shell(3)</a>). Start
the Erlang shell (in Linux or UNIX) by starting a shell or
command interpreter in your operating system and typing
<span class="code">erl</span>, you will see something like this.
</p>
<div class="example"><pre>
% <strong>erl</strong>
Erlang (BEAM) emulator version 5.2 [source] [hipe]

Eshell V5.2  (abort with ^G)
1&#62;
</pre></div>

<p>Now type in &#34;2 + 5.&#34; as shown below.
</p>
<div class="example"><pre>
1&#62; <strong>2 + 5.</strong>
7
2&#62;
</pre></div>

<p>In Windows, the shell is started by double-clicking on the Erlang
shell icon.
</p>
<p>You'll notice that the Erlang shell has numbered the lines that
can be entered, (as 1&#62; 2&#62;) and that it has correctly told you
that 2 + 5 is 7! Also notice that you have to tell it you are
done entering code by finishing with a full stop &#34;.&#34; and a
carriage return. If you make mistakes writing things in the shell,
you can delete things by using the backspace key as in most
shells. There are many more editing commands in the shell
(See the chapter <a href="javascript:erlhref('../../', 'erts', 'tty.html');">&#34;tty - A command line interface&#34;</a> in ERTS User's Guide).
</p>
<p>(Note: you will find a lot of line numbers given by the shell
out of sequence in this tutorial as it was written and the code
tested in several sessions).
</p>
<p>Now let's try a more complex calculation.
</p>
<div class="example"><pre>
2&#62; <strong>(42 + 77) * 66 / 3.</strong>
2618.0
</pre></div>

<p>Here you can see the use of brackets and the multiplication
operator &#34;*&#34; and division operator &#34;/&#34;, just as in normal
arithmetic (see the chapter
<a href="javascript:erlhref('../../', 'doc/reference_manual', 'expressions.html');">&#34;Arithmetic Expressions&#34;</a> in the Erlang Reference Manual).
</p>
<p>To shutdown the Erlang system and the Erlang shell type
Control-C. You will see the following output:
</p>
<div class="example"><pre>
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
       (v)ersion (k)ill (D)b-tables (d)istribution
<strong>a</strong>
%
</pre></div>

<p>Type &#34;a&#34; to leave the Erlang system.
</p>
<p>Another way to shutdown the Erlang system is by entering
<span class="code">halt()</span>:
</p>
<div class="example"><pre>
3&#62; <strong>halt().</strong>
% 
</pre></div>
<a name="2.2"><!-- Empty --></a>
<h3>2.2 Modules and Functions</h3>

<p>A programming language isn't much use if you can just run code
from the shell. So here is a small Erlang program. Enter it into
a file called <span class="code">tut.erl</span> (the file name <span class="code">tut.erl</span> is
important, also make sure that it is in the same directory as
the one where you started <span class="code">erl</span>) using a suitable
text editor. If you are lucky your editor will have an Erlang
mode which will make it easier for you to enter and format your
code nicely (see the chapter
<a href="javascript:erlhref('../../', 'tools', 'erlang_mode_chapter.html');">&#34;The Erlang mode for Emacs&#34;</a> in Tools User's Guide), but you can manage
perfectly well without. Here's the code to enter:
</p>
<div class="example"><pre>
-module(tut).
-export([double/1]).

double(X) -&#62;
    2 * X.
</pre></div>

<p>It's not hard to guess that this &#34;program&#34; doubles the value of
numbers. I'll get back to the first two lines later. Let's compile
the program. This can be done in your Erlang shell as shown below:
</p>
<div class="example"><pre>
3&#62; <strong>c(tut).</strong>
{ok,tut}
</pre></div>

<p>The <span class="code">{ok,tut}</span> tells you that the compilation was OK. If it
said &#34;error&#34; instead, you have made some mistake in the text you
entered and there will also be error messages to give you some
idea as to what has gone wrong so you can change what you have
written and try again.
</p>
<p>Now lets run the program.
</p>
<div class="example"><pre>
4&#62; <strong>tut:double(10).</strong>
20
</pre></div>

<p>As expected double of 10 is 20.
</p>
<p>Now let's get back to the first two lines. Erlang programs are
written in files. Each file contains what we call an Erlang
<strong>module</strong>. The first line of code in the module tells us
the name of the module (see the chapter
<a href="javascript:erlhref('../../', 'doc/reference_manual', 'modules.html');">&#34;Modules&#34;</a>
in the Erlang Reference Manual).
</p>
<div class="example"><pre>
-module(tut).
</pre></div>

<p>This tells us that the module is called <strong>tut</strong>. Note
the &#34;.&#34; at the end of the line. The files which are used to store
the module must have the same name as the module but with
the extension &#34;.erl&#34;. In our case the file name is <span class="code">tut.erl</span>.
When we use a function in another module, we use the syntax,
<span class="code">module_name:function_name(arguments)</span>. So
</p>
<div class="example"><pre>
4&#62; <strong>tut:double(10).</strong>
</pre></div>

<p>means call function <span class="code">double</span> in module <span class="code">tut</span> with
argument &#34;10&#34;.
</p>
<p>The second line:
</p>
<div class="example"><pre>
-export([double/1]).
</pre></div>

<p>says that the module <span class="code">tut</span> contains a function called
<span class="code">double</span> which takes one argument (<span class="code">X</span> in our example)
and that this function can be called from outside the module
<span class="code">tut</span>. More about this later. Again note the &#34;.&#34; at the end
of the line.
</p>
<p>Now for a more complicated example, the factorial of a number
(e.g. factorial of 4 is 4 * 3 * 2 * 1). Enter the following code
in a file called <span class="code">tut1.erl</span>.
</p>
<div class="example"><pre>
-module(tut1).
-export([fac/1]).

fac(1) -&#62;
    1;
fac(N) -&#62;
    N * fac(N - 1).
</pre></div>

<p>Compile the file
</p>
<div class="example"><pre>
5&#62; <strong>c(tut1).</strong>
{ok,tut1}
</pre></div>

<p>And now calculate the factorial of 4.
</p>
<div class="example"><pre>
6&#62; <strong>tut1:fac(4).</strong>
24
</pre></div>

<p>The first part:
</p>
<div class="example"><pre>
fac(1) -&#62;
    1;
</pre></div>

<p>says that the factorial of 1 is 1. Note that we end this part
with a &#34;;&#34; which indicates that there is more of this function to
come. The second part:
</p>
<div class="example"><pre>
fac(N) -&#62;
    N * fac(N - 1).
</pre></div>

<p>says that the factorial of N is N multiplied by the factorial of
N - 1. Note that this part ends with a &#34;.&#34; saying that there are
no more parts of this function.
</p>
<p>A function can have many arguments. Let's expand the module
<span class="code">tut1</span> with the rather stupid function to multiply two
numbers:
</p>
<div class="example"><pre>
-module(tut1).
-export([fac/1, mult/2]).

fac(1) -&#62;
    1;
fac(N) -&#62;
    N * fac(N - 1).

mult(X, Y) -&#62;
    X * Y.
</pre></div>

<p>Note that we have also had to expand the <span class="code">-export</span> line
with the information that there is another function <span class="code">mult</span>
with two arguments.
</p>
<p>Compile:
</p>
<div class="example"><pre>
7&#62; <strong>c(tut1).</strong>
{ok,tut1}
</pre></div>

<p>and try it out:
</p>
<div class="example"><pre>
8&#62; <strong>tut1:mult(3,4).</strong>
12
</pre></div>

<p>In the example above the numbers are integers and the arguments
in the functions in the code, <span class="code">N</span>, <span class="code">X</span>, <span class="code">Y</span> are
called variables. Variables must start with a capital letter
(see the chapter
<a href="javascript:erlhref('../../', 'doc/reference_manual', 'expressions.html');">&#34;Variables&#34;</a>
in the Erlang Reference Manual). Examples of variable could be
<span class="code">Number</span>, <span class="code">ShoeSize</span>, <span class="code">Age</span> etc.
</p><a name="2.3"><!-- Empty --></a>
<h3>2.3 Atoms</h3>

<p>Atoms are another data type in Erlang. Atoms start with a small
letter ((see the chapter
<a href="javascript:erlhref('../../', 'doc/reference_manual', 'data_types.html');">&#34;Atom&#34;</a>
in the Erlang Reference Manual)), for example: <span class="code">charles</span>,
<span class="code">centimeter</span>, <span class="code">inch</span>. Atoms are simply names, nothing
else. They are not like variables which can have a value.
</p>
<p>Enter the next program (file: <span class="code">tut2.erl</span>) which could be
useful for converting from inches to centimeters and vice versa:
</p>
<div class="example"><pre>
-module(tut2).
-export([convert/2]).

convert(M, inch) -&#62;
    M / 2.54;

convert(N, centimeter) -&#62;
    N * 2.54.
</pre></div>

<p>Compile and test:
</p>
<div class="example"><pre>
9&#62; <strong>c(tut2).</strong>
{ok,tut2}
10&#62; <strong>tut2:convert(3, inch).</strong>
1.1811023622047243
11&#62; <strong>tut2:convert(7, centimeter).</strong>
17.78
</pre></div>

<p>Notice that I have introduced decimals (floating point numbers)
without any explanation, but I guess you can cope with that.
</p>
<p>See what happens if I enter something other than centimeter or
inch in the convert function:
</p>
<div class="example"><pre>
12&#62; <strong>tut2:convert(3, miles).</strong>
** exception error: no function clause matching tut2:convert(3,miles)
</pre></div>

<p>The two parts of the <span class="code">convert</span> function are called its
clauses. Here we see that &#34;miles&#34; is not part of either of
the clauses. The Erlang system can't <strong>match</strong> either of
the clauses so we get an error message <span class="code">function_clause</span>.
The shell formats the error message nicely, but the error tuple 
is saved in the shell's history list and can be output by the shell 
command <span class="code">v/1</span>:
</p>
<div class="example"><pre>
13&#62; <strong>v(13)</strong>
{'EXIT',{function_clause,[{tut2,convert,[3,miles]},
                          {erl_eval,do_apply,5},
                          {shell,exprs,6},
                          {shell,eval_exprs,6},
                          {shell,eval_loop,3}]}}
</pre></div>
<a name="2.4"><!-- Empty --></a>
<h3>2.4 Tuples</h3>

<p>Now the <span class="code">tut2</span> program is hardly good programming style.
Consider:
</p>
<div class="example"><pre>
tut2:convert(3, inch).
</pre></div>

<p>Does this mean that 3 is in inches? or that 3 is in centimeters
and we want to convert it to inches? So Erlang has a way to group
things together to make things more understandable. We call these
<strong>tuples</strong>. Tuples are surrounded by &#34;{&#34; and &#34;}&#34;.
</p>
<p>So we can write <span class="code">{inch,3}</span> to denote 3 inches and
<span class="code">{centimeter,5}</span> to denote 5 centimeters. Now let's write a
new program which converts centimeters to inches and vice versa.
(file <span class="code">tut3.erl</span>).
</p>
<div class="example"><pre>
-module(tut3).
-export([convert_length/1]).

convert_length({centimeter, X}) -&#62;
    {inch, X / 2.54};
convert_length({inch, Y}) -&#62;
    {centimeter, Y * 2.54}.
</pre></div>

<p>Compile and test:
</p>
<div class="example"><pre>
14&#62; <strong>c(tut3).</strong>
{ok,tut3}
15&#62; <strong>tut3:convert_length({inch, 5}).</strong>
{centimeter,12.7}
16&#62; <strong>tut3:convert_length(tut3:convert_length({inch, 5})).</strong>
{inch,5.0}
</pre></div>

<p>Note on line 16 we convert 5 inches to centimeters and back
again and reassuringly get back to the original value. I.e
the argument to a function can be the result of another function.
Pause for a moment and consider how line 16 (above) works.
The argument we have given the function <span class="code">{inch,5}</span> is first
matched against the first head clause of <span class="code">convert_length</span>
i.e. <span class="code">convert_length({centimeter,X})</span> where it can be seen
that <span class="code">{centimeter,X}</span> does not match <span class="code">{inch,5}</span>
(the head is the bit before the &#34;-&#62;&#34;). This having failed, we try
the head of the next clause i.e. <span class="code">convert_length({inch,Y})</span>,
this matches and <span class="code">Y</span> get the value 5.
</p>
<p>We have shown tuples with two parts above, but tuples can have
as many parts as we want and contain any valid Erlang
<strong>term</strong>. For example, to represent the temperature of
various cities of the world we could write
</p>
<div class="example"><pre>
{moscow, {c, -10}}
{cape_town, {f, 70}}
{paris, {f, 28}}
</pre></div>

<p>Tuples have a fixed number of things in them. We call each thing
in a tuple an element. So in the tuple <span class="code">{moscow,{c,-10}}</span>,
element 1 is <span class="code">moscow</span> and element 2 is <span class="code">{c,-10}</span>. I
have chosen <span class="code">c</span> meaning Centigrade (or Celsius) and <span class="code">f</span>
meaning Fahrenheit.
</p><a name="2.5"><!-- Empty --></a>
<h3>2.5 Lists</h3>

<p>Whereas tuples group things together, we also want to be able to
represent lists of things. Lists in Erlang are surrounded by &#34;[&#34;
and &#34;]&#34;. For example a list of the temperatures of various cities
in the world could be:
</p>
<div class="example"><pre>
[{moscow, {c, -10}}, {cape_town, {f, 70}}, {stockholm, {c, -4}},
 {paris, {f, 28}}, {london, {f, 36}}]
</pre></div>

<p>Note that this list was so long that it didn't fit on one line.
This doesn't matter, Erlang allows line breaks at all &#34;sensible
places&#34; but not, for example, in the middle of atoms, integers
etc.
</p>
<p>A very useful way of looking at parts of lists, is by using &#34;|&#34;.
This is best explained by an example using the shell.
</p>
<div class="example"><pre>
17&#62; <strong>[First |TheRest] = [1,2,3,4,5].</strong>
[1,2,3,4,5]
18&#62; <strong>First.</strong>
1
19&#62; <strong>TheRest.</strong>
[2,3,4,5]
</pre></div>

<p>We use | to separate the first elements of the list from
the rest of the list. (<span class="code">First</span> has got value 1 and
<span class="code">TheRest</span> value [2,3,4,5]).
</p>
<p>Another example:
</p>
<div class="example"><pre>
20&#62; <strong>[E1, E2 | R] = [1,2,3,4,5,6,7].</strong>
[1,2,3,4,5,6,7]
21&#62; <strong>E1.</strong>
1
22&#62; <strong>E2.</strong>
2
23&#62; <strong>R.</strong>
[3,4,5,6,7]
</pre></div>

<p>Here we see the use of | to get the first two elements from
the list. Of course if we try to get more elements from the list
than there are elements in the list we will get an error. Note
also the special case of the list with no elements [].
</p>
<div class="example"><pre>
24&#62; <strong>[A, B | C] = [1, 2].</strong>
[1,2]
25&#62; <strong>A.</strong>
1
26&#62; <strong>B.</strong>
2
27&#62; <strong>C.</strong>
[]
</pre></div>

<p>In all the examples above, I have been using new variable names,
not reusing the old ones: <span class="code">First</span>, <span class="code">TheRest</span>, <span class="code">E1</span>,
<span class="code">E2</span>, <span class="code">R</span>, <span class="code">A</span>, <span class="code">B</span>, <span class="code">C</span>. The reason
for this is that a variable can only be given a value once in its
context (scope). I'll get back to this later, it isn't so
peculiar as it sounds!
</p>
<p>The following example shows how we find the length of a list:
</p>
<div class="example"><pre>
-module(tut4).

-export([list_length/1]).

list_length([]) -&#62;
    0;    
list_length([First | Rest]) -&#62;
    1 + list_length(Rest).
</pre></div>

<p>Compile (file <span class="code">tut4.erl</span>) and test:
</p>
<div class="example"><pre>
28&#62; <strong>c(tut4).</strong>
{ok,tut4}
29&#62; <strong>tut4:list_length([1,2,3,4,5,6,7]).</strong>
7
</pre></div>

<p>Explanation:
</p>
<div class="example"><pre>
list_length([]) -&#62;
    0;
</pre></div>

<p>The length of an empty list is obviously 0.
</p>
<div class="example"><pre>
list_length([First | Rest]) -&#62;
    1 + list_length(Rest).
</pre></div>

<p>The length of a list with the first element <span class="code">First</span> and
the remaining elements <span class="code">Rest</span> is 1 + the length of
<span class="code">Rest</span>.
</p>
<p>(Advanced readers only: This is not tail recursive, there is a
better way to write this function).
</p>
<p>In general we can say we use tuples where we would use &#34;records&#34;
or &#34;structs&#34; in other languages and we use lists when we want to
represent things which have varying sizes, (i.e. where we would
use linked lists in other languages).
</p>
<p>Erlang does not have a string date type, instead strings can be
represented by lists of ASCII characters. So the list
<span class="code">[97,98,99]</span> is equivalent to &#34;abc&#34;. The Erlang shell is
&#34;clever&#34; and guesses the what sort of list we mean and outputs it
in what it thinks is the most appropriate form, for example:
</p>
<div class="example"><pre>
30&#62; <strong>[97,98,99].</strong>
&#34;abc&#34;
</pre></div>
<a name="2.6"><!-- Empty --></a>
<h3>2.6 Standard Modules and Manual Pages</h3>

<p>Erlang has a lot of standard modules to help you do things. For
example, the module <span class="code">io</span> contains a lot of functions to help
you do formatted input/output. To look up information about
standard modules, the command <span class="code">erl -man</span> can be used at
the operating shell or command prompt (i.e. at the same place as
that where you started <span class="code">erl</span>). Try the operating system
shell command:
</p>
<div class="example"><pre>
% <strong>erl -man io</strong>
ERLANG MODULE DEFINITION                                    io(3)

MODULE
     io - Standard I/O Server Interface Functions

DESCRIPTION
     This module provides an  interface  to  standard  Erlang  IO
     servers. The output functions all return ok if they are suc-
     ...
</pre></div>

<p>If this doesn't work on your system, the documentation is
included as HTML in the Erlang/OTP release, or you can read
the documentation as HTML or download it as PDF from either of
the sites www.erlang.se (commercial Erlang) or www.erlang.org
(open source), for example for release R9B:
</p>
<div class="example"><pre>
http://www.erlang.org/doc/r9b/doc/index.html
</pre></div>
<a name="2.7"><!-- Empty --></a>
<h3>2.7 Writing Output to a Terminal</h3>

<p>It's nice to be able to do formatted output in these example, so
the next example shows a simple way to use to use
the <span class="code">io:format</span> function. Of course, just like all other
exported functions, you can test the <span class="code">io:format</span> function in
the shell:
</p>
<div class="example"><pre>
31&#62; <strong>io:format(&#34;hello world~n&#34;, []).</strong>
hello world
ok
32&#62; <strong>io:format(&#34;this outputs one Erlang term: ~w~n&#34;, [hello]).</strong>
this outputs one Erlang term: hello
ok
33&#62; <strong>io:format(&#34;this outputs two Erlang terms: ~w~w~n&#34;, [hello, world]).</strong>
this outputs two Erlang terms: helloworld
ok
34&#62; <strong>io:format(&#34;this outputs two Erlang terms: ~w ~w~n&#34;, [hello, world]).</strong>
this outputs two Erlang terms: hello world
ok
</pre></div>

<p>The function <span class="code">format/2</span> (i.e. <span class="code">format</span> with two
arguments) takes two lists. The first one is nearly always a list
written between &#34; &#34;. This list is printed out as it stands,
except that each ~w is replaced by a term taken in order from
the second list. Each ~n is replaced by a new line.
The <span class="code">io:format/2</span> function itself returns the atom <span class="code">ok</span>
if everything goes as planned. Like other functions in Erlang, it
crashes if an error occurs. This is not a fault in Erlang, it is
a deliberate policy. Erlang has sophisticated mechanisms to
handle errors which we will show later. As an exercise, try to
make <span class="code">io:format</span> crash, it shouldn't be difficult. But
notice that although <span class="code">io:format</span> crashes, the Erlang shell
itself does not crash.
</p><a name="2.8"><!-- Empty --></a>
<h3>2.8 A Larger Example</h3>

<p>Now for a larger example to consolidate what we have learnt so
far. Assume we have a list of temperature readings from a number
of cities in the world. Some of them are in Celsius (Centigrade)
and some in Fahrenheit (as in the previous list). First let's
convert them all to Celsius, then let's print out the data neatly.
</p>
<div class="example"><pre>
%% This module is in file tut5.erl

-module(tut5).
-export([format_temps/1]).

%% Only this function is exported
format_temps([])-&#62;                        % No output for an empty list
    ok;
format_temps([City | Rest]) -&#62;
    print_temp(convert_to_celsius(City)),
    format_temps(Rest).

convert_to_celsius({Name, {c, Temp}}) -&#62;  % No conversion needed
    {Name, {c, Temp}};
convert_to_celsius({Name, {f, Temp}}) -&#62;  % Do the conversion
    {Name, {c, (Temp - 32) * 5 / 9}}.

print_temp({Name, {c, Temp}}) -&#62;
    io:format(&#34;~-15w ~w c~n&#34;, [Name, Temp]).
</pre></div>

<div class="example"><pre>
35&#62; <strong>c(tut5).</strong>
{ok,tut5}
36&#62; <strong>tut5:format_temps([{moscow, {c, -10}}, {cape_town, {f, 70}},</strong>
<strong>{stockholm, {c, -4}}, {paris, {f, 28}}, {london, {f, 36}}]).</strong>
moscow          -10 c
cape_town       21.11111111111111 c
stockholm       -4 c
paris           -2.2222222222222223 c
london          2.2222222222222223 c
ok
</pre></div>

<p>Before we look at how this program works, notice that we have
added a few comments to the code. A comment starts with a %
character and goes on to the end of the line. Note as well that
the <span class="code">-export([format_temps/1]).</span> line only includes
the function <span class="code">format_temps/1</span>, the other functions are
<strong>local</strong> functions, i.e. they are not visible from outside
the module <span class="code">tut5</span>.
</p>
<p>Note as well that when testing the program from the shell, I had
to spread the input over two lines as the line was too long.
</p>
<p>When we call <span class="code">format_temps</span> the first time, <span class="code">City</span>
gets the value <span class="code">{moscow,{c,-10}}</span> and <span class="code">Rest</span> is
the rest of the list. So we call the function
<span class="code">print_temp(convert_to_celsius({moscow,{c,-10}}))</span>.
</p>
<p>Here we see a function call as
<span class="code">convert_to_celsius({moscow,{c,-10}})</span> as the argument to
the function <span class="code">print_temp</span>. When we <strong>nest</strong> function
calls like this we execute (evaluate) them from the inside out.
I.e. we first evaluate <span class="code">convert_to_celsius({moscow,{c,-10}})</span>
which gives the value <span class="code">{moscow,{c,-10}}</span> as the temperature
is already in Celsius and then we evaluate
<span class="code">print_temp({moscow,{c,-10}})</span>. The function
<span class="code">convert_to_celsius</span> works in a similar way to
the <span class="code">convert_length</span> function in the previous example.
</p>
<p><span class="code">print_temp</span> simply calls <span class="code">io:format</span> in a similar way
to what has been described above. Note that ~-15w says to print
the &#34;term&#34; with a field length (width) of 15 and left justify it.
(<a href="javascript:erlhref('../../', 'stdlib', 'io.html#fwrite-1');">io(3)</a>).
</p>
<p>Now we call <span class="code">format_temps(Rest)</span> with the rest of the list
as an argument. This way of doing things is similar to the loop
constructs in other languages. (Yes, this is recursion, but don't
let that worry you). So the same <span class="code">format_temps</span> function is
called again, this time <span class="code">City</span> gets the value
<span class="code">{cape_town,{f,70}}</span> and we repeat the same procedure as
before. We go on doing this until the list becomes empty, i.e. [],
which causes the first clause <span class="code">format_temps([])</span> to match.
This simply returns (results in) the atom <span class="code">ok</span>, so
the program ends.
</p><a name="2.9"><!-- Empty --></a>
<h3>2.9 Matching, Guards and Scope of Variables</h3>

<p>It could be useful to find the maximum and minimum temperature
in lists like this. Before extending the program to do this,
let's look at functions for finding the maximum value of
the elements in a list:
</p>
<div class="example"><pre>
-module(tut6).
-export([list_max/1]).

list_max([Head|Rest]) -&#62;
   list_max(Rest, Head).

list_max([], Res) -&#62;
    Res;
list_max([Head|Rest], Result_so_far) when Head &#62; Result_so_far -&#62;
    list_max(Rest, Head);
list_max([Head|Rest], Result_so_far)  -&#62;
    list_max(Rest, Result_so_far).
</pre></div>

<div class="example"><pre>
37&#62; <strong>c(tut6).</strong>
{ok,tut6}
38&#62; <strong>tut6:list_max([1,2,3,4,5,7,4,3,2,1]).</strong>
7
</pre></div>

<p>First note that we have two functions here with the same name
<span class="code">list_max</span>. However each of these takes a different number
of arguments (parameters). In Erlang these are regarded as
completely different functions. Where we need to distinguish
between these functions we write <span class="code">name/arity</span>, where
<span class="code">name</span> is the name of the function and <span class="code">arity</span> is
the number of arguments, in this case <span class="code">list_max/1</span> and
<span class="code">list_max/2</span>.
</p>
<p>This is an example where we walk through a list &#34;carrying&#34; a
value with us, in this case <span class="code">Result_so_far</span>.
<span class="code">list_max/1</span> simply assumes that the max value of the list
is the head of the list and calls <span class="code">list_max/2</span> with the rest
of the list and the value of the head of the list, in the above
this would be <span class="code">list_max([2,3,4,5,7,4,3,2,1],1)</span>. If we tried
to use <span class="code">list_max/1</span> with an empty list or tried to use it
with something which isn't a list at all, we would cause an error.
Note that the Erlang philosophy is not to handle errors of this
type in the function they occur, but to do so elsewhere. More
about this later.
</p>
<p>In <span class="code">list_max/2</span> we walk down the list and use <span class="code">Head</span>
instead of <span class="code">Result_so_far</span> when <span class="code">Head</span> &#62;
<span class="code">Result_so_far</span>. <span class="code">when</span> is a special word we use before
the -&#62; in the function to say that we should only use this part
of the function if the test which follows is true. We call tests
of this type a <strong>guard</strong>. If the guard isn't true (we say
the guard fails), we try the next part of the function. In this
case if <span class="code">Head</span> isn't greater than <span class="code">Result_so_far</span> then
it must be smaller or equal to is, so we don't need a guard on
the next part of the function.
</p>
<p>Some useful operators in guards are, &#60; less than, &#62;
greater than, == equal, &#62;= greater or equal, =&#60; less or
equal, /= not equal. (see the chapter
<a href="javascript:erlhref('../../', 'doc/reference_manual', 'expressions.html');">&#34;Guard Sequences&#34;</a> in the Erlang Reference Manual).
</p>
<p>To change the above program to one which works out the minimum
value of the element in a list, all we would need to do is to
write &#60; instead of &#62;. (But it would be wise to change
the name of the function to <span class="code">list_min</span> :-).
</p>
<p>Remember that I mentioned earlier that a variable could only be
given a value once in its scope? In the above we see, for example,
that <span class="code">Result_so_far</span> has been given several values. This is
OK since every time we call <span class="code">list_max/2</span> we create a new
scope and one can regard the <span class="code">Result_so_far</span> as a completely
different variable in each scope.
</p>
<p>Another way of creating and giving a variable a value is by using
the match operator = . So if I write <span class="code">M = 5</span>, a variable
called <span class="code">M</span> will be created and given the value 5. If, in
the same scope I then write <span class="code">M = 6</span>, I'll get an error. Try
this out in the shell:
</p>
<div class="example"><pre>
39&#62; <strong>M = 5.</strong>
5
40&#62; <strong>M = 6.</strong>
** exception error: no match of right hand side value 6
41&#62; <strong>M = M + 1.</strong>
** exception error: no match of right hand side value 6
42&#62; <strong>N = M + 1.</strong>
6
</pre></div>

<p>The use of the match operator is particularly useful for pulling
apart Erlang terms and creating new ones.
</p>
<div class="example"><pre>
43&#62; <strong>{X, Y} = {paris, {f, 28}}.</strong>
{paris,{f,28}}
44&#62; <strong>X.</strong>
paris
45&#62; <strong>Y.</strong>
{f,28}
</pre></div>

<p>Here we see that <span class="code">X</span> gets the value <span class="code">paris</span> and
<span class="code">Y</span><span class="code">{f,28}</span>.
</p>
<p>Of course if we try to do the same again with another city, we
get an error:
</p>
<div class="example"><pre>
46&#62; <strong>{X, Y} = {london, {f, 36}}.</strong>
** exception error: no match of right hand side value {london,{f,36}}
</pre></div>

<p>Variables can also be used to improve the readability of
programs, for example, in the <span class="code">list_max/2</span> function above,
we could write:
</p>
<div class="example"><pre>
list_max([Head|Rest], Result_so_far) when Head &#62; Result_so_far -&#62;
    New_result_far = Head,
    list_max(Rest, New_result_far);
</pre></div>

<p>which is possibly a little clearer.
</p><a name="2.10"><!-- Empty --></a>
<h3>2.10 More About Lists</h3>

<p>Remember that the | operator can be used to get the head of a
list:
</p>
<div class="example"><pre>
47&#62; <strong>[M1|T1] = [paris, london, rome].</strong>
[paris,london,rome]
48&#62; <strong>M1.</strong>
paris
49&#62; <strong>T1.</strong>
[london,rome]
</pre></div>

<p>The | operator can also be used to add a head to a list:
</p>
<div class="example"><pre>
50&#62; <strong>L1 = [madrid | T1].</strong>
[madrid,london,rome]
51&#62; <strong>L1.</strong>
[madrid,london,rome]
</pre></div>

<p>Now an example of this when working with lists - reversing
the order of a list:
</p>
<div class="example"><pre>
-module(tut8).

-export([reverse/1]).

reverse(List) -&#62;
    reverse(List, []).

reverse([Head | Rest], Reversed_List) -&#62;
    reverse(Rest, [Head | Reversed_List]);
reverse([], Reversed_List) -&#62;
    Reversed_List.
</pre></div>

<div class="example"><pre>
52&#62; <strong>c(tut8).</strong>
{ok,tut8}
53&#62; <strong>tut8:reverse([1,2,3]).</strong>
[3,2,1]
</pre></div>

<p>Consider how <span class="code">Reversed_List</span> is built. It starts as [], we
then successively take off the heads of the list to be reversed
and add them to the the <span class="code">Reversed_List</span>, as shown in
the following:
</p>
<div class="example"><pre>
reverse([1|2,3], []) =&#62;
    reverse([2,3], [1|[]])

reverse([2|3], [1]) =&#62;
    reverse([3], [2|[1])

reverse([3|[]], [2,1]) =&#62;
    reverse([], [3|[2,1]])

reverse([], [3,2,1]) =&#62;
    [3,2,1]
</pre></div>

<p>The module <span class="code">lists</span> contains a lot of functions for
manipulating lists, for example for reversing them, so before you
write a list manipulating function it is a good idea to check
that one isn't already written for you. (see
<a href="javascript:erlhref('../../', 'stdlib', 'lists.html');">lists(3)</a>).
</p>
<p>Now lets get back to the cities and temperatures, but take a more
structured approach this time. First let's convert the whole list
to Celsius as follows and test the function:
</p>
<div class="example"><pre>
-module(tut7).
-export([format_temps/1]).

format_temps(List_of_cities) -&#62;
    convert_list_to_c(List_of_cities).

convert_list_to_c([{Name, {f, F}} | Rest]) -&#62;
    Converted_City = {Name, {c, (F -32)* 5 / 9}},
    [Converted_City | convert_list_to_c(Rest)];
              
convert_list_to_c([City | Rest]) -&#62;
    [City | convert_list_to_c(Rest)];

convert_list_to_c([]) -&#62;
    [].
</pre></div>

<div class="example"><pre>
54&#62; <strong>c(tut7).</strong>
{ok, tut7}.
55&#62; <strong>tut7:format_temps([{moscow, {c, -10}}, {cape_town, {f, 70}},</strong>
<strong>{stockholm, {c, -4}}, {paris, {f, 28}}, {london, {f, 36}}]).</strong>
[{moscow,{c,-10}},
 {cape_town,{c,21.11111111111111}},
 {stockholm,{c,-4}},
 {paris,{c,-2.2222222222222223}},
 {london,{c,2.2222222222222223}}]
</pre></div>

<p>Looking at this bit by bit:
</p>
<div class="example"><pre>
format_temps(List_of_cities) -&#62;
    convert_list_to_c(List_of_cities).
</pre></div>

<p>Here we see that <span class="code">format_temps/1</span> calls
<span class="code">convert_list_to_c/1</span>. <span class="code">convert_list_to_c/1</span> takes off
the head of the <span class="code">List_of_cities</span>, converts it to Celsius if
needed. The | operator is used to add the (maybe) converted
to the converted rest of the list:
</p>
<div class="example"><pre>
[Converted_City | convert_list_to_c(Rest)];
</pre></div>

<p>or
</p>
<div class="example"><pre>
[City | convert_list_to_c(Rest)];
</pre></div>

<p>We go on doing this until we get to the end of the list (i.e.
the list is empty:
</p>
<div class="example"><pre>
convert_list_to_c([]) -&#62;
    [].
</pre></div>

<p>Now we have converted the list, we add a function to print it:
</p>
<div class="example"><pre>
-module(tut7).
-export([format_temps/1]).

format_temps(List_of_cities) -&#62;
    Converted_List = convert_list_to_c(List_of_cities),
    print_temp(Converted_List).

convert_list_to_c([{Name, {f, F}} | Rest]) -&#62;
    Converted_City = {Name, {c, (F -32)* 5 / 9}},
    [Converted_City | convert_list_to_c(Rest)];
              
convert_list_to_c([City | Rest]) -&#62;
    [City | convert_list_to_c(Rest)];

convert_list_to_c([]) -&#62;
    [].

print_temp([{Name, {c, Temp}} | Rest]) -&#62;
    io:format(&#34;~-15w ~w c~n&#34;, [Name, Temp]),
    print_temp(Rest);
print_temp([]) -&#62;
    ok.
</pre></div>

<div class="example"><pre>
56&#62; <strong>c(tut7).</strong>
{ok,tut7}
57&#62; <strong>tut7:format_temps([{moscow, {c, -10}}, {cape_town, {f, 70}},</strong>
<strong>{stockholm, {c, -4}}, {paris, {f, 28}}, {london, {f, 36}}]).</strong>
moscow          -10 c
cape_town       21.11111111111111 c
stockholm       -4 c
paris           -2.2222222222222223 c
london          2.2222222222222223 c
ok
</pre></div>

<p>We now have to add a function to find the cities with
the maximum and minimum temperatures. The program below isn't
the most efficient way of doing this as we walk through the list
of cities four times. But it is better to first strive for
clarity and correctness and to make programs efficient only if
really needed.
</p>
<div class="example"><pre>
-module(tut7).
-export([format_temps/1]).

format_temps(List_of_cities) -&#62;
    Converted_List = convert_list_to_c(List_of_cities),
    print_temp(Converted_List),
    {Max_city, Min_city} = find_max_and_min(Converted_List),
    print_max_and_min(Max_city, Min_city).

convert_list_to_c([{Name, {f, Temp}} | Rest]) -&#62;
    Converted_City = {Name, {c, (Temp -32)* 5 / 9}},
    [Converted_City | convert_list_to_c(Rest)];
              
convert_list_to_c([City | Rest]) -&#62;
    [City | convert_list_to_c(Rest)];

convert_list_to_c([]) -&#62;
    [].

print_temp([{Name, {c, Temp}} | Rest]) -&#62;
    io:format(&#34;~-15w ~w c~n&#34;, [Name, Temp]),
    print_temp(Rest);
print_temp([]) -&#62;
    ok.

find_max_and_min([City | Rest]) -&#62;
    find_max_and_min(Rest, City, City).

find_max_and_min([{Name, {c, Temp}} | Rest], 
         {Max_Name, {c, Max_Temp}}, 
         {Min_Name, {c, Min_Temp}}) -&#62;
    if 
        Temp &#62; Max_Temp -&#62;
            Max_City = {Name, {c, Temp}};           % Change
        true -&#62; 
            Max_City = {Max_Name, {c, Max_Temp}} % Unchanged
    end,
    if
         Temp &#60; Min_Temp -&#62;
            Min_City = {Name, {c, Temp}};           % Change
        true -&#62; 
            Min_City = {Min_Name, {c, Min_Temp}} % Unchanged
    end,
    find_max_and_min(Rest, Max_City, Min_City);

find_max_and_min([], Max_City, Min_City) -&#62;
    {Max_City, Min_City}.

print_max_and_min({Max_name, {c, Max_temp}}, {Min_name, {c, Min_temp}}) -&#62;
    io:format(&#34;Max temperature was ~w c in ~w~n&#34;, [Max_temp, Max_name]),
    io:format(&#34;Min temperature was ~w c in ~w~n&#34;, [Min_temp, Min_name]).
</pre></div>

<div class="example"><pre>
58&#62; <strong>c(tut7).</strong>
{ok, tut7}
59&#62; <strong>tut7:format_temps([{moscow, {c, -10}}, {cape_town, {f, 70}},</strong>
<strong>{stockholm, {c, -4}}, {paris, {f, 28}}, {london, {f, 36}}]).</strong>
moscow          -10 c
cape_town       21.11111111111111 c
stockholm       -4 c
paris           -2.2222222222222223 c
london          2.2222222222222223 c
Max temperature was 21.11111111111111 c in cape_town
Min temperature was -10 c in moscow
ok
</pre></div>
<a name="2.11"><!-- Empty --></a>
<h3>2.11 If and Case</h3>

<p>The function <span class="code">find_max_and_min</span> works out the maximum and
minimum temperature. We have introduced a new construct here
<span class="code">if</span>. If works as follows:
</p>
<div class="example"><pre>
if
    Condition 1 -&#62;
        Action 1;
    Condition 2 -&#62;
        Action 2;
    Condition 3 -&#62;
        Action 3;
    Condition 4 -&#62;
        Action 4
end
</pre></div>

<p>Note there is no &#34;;&#34; before <span class="code">end</span>! Conditions are the same
as guards, tests which succeed or fail. Erlang starts at the top
until it finds a condition which succeeds and then it evaluates
(performs) the action following the condition and ignores all
other conditions and action before the <span class="code">end</span>. If no
condition matches, there will be a run-time failure. A condition
which always is succeeds is the atom, <span class="code">true</span> and this is
often used last in an <span class="code">if</span> meaning do the action following
the <span class="code">true</span> if all other conditions have failed.
</p>
<p>The following is a short program to show the workings of
<span class="code">if</span>.
</p>
<div class="example"><pre>
-module(tut9).
-export([test_if/2]).

test_if(A, B) -&#62;
    if 
        A == 5 -&#62;
            io:format(&#34;A == 5~n&#34;, []),
            a_equals_5;
        B == 6 -&#62;
            io:format(&#34;B == 6~n&#34;, []),
            b_equals_6;
        A == 2, B == 3 -&#62;                      %i.e. A equals 2 and B equals 3
            io:format(&#34;A == 2, B == 3~n&#34;, []),
            a_equals_2_b_equals_3;
        A == 1 ; B == 7 -&#62;                     %i.e. A equals 1 or B equals 7
            io:format(&#34;A == 1 ; B == 7~n&#34;, []),
            a_equals_1_or_b_equals_7
    end.
</pre></div>

<p>Testing this program gives:
</p>
<div class="example"><pre>
60&#62; <strong>c(tut9).</strong>
{ok,tut9}
61&#62; <strong>tut9:test_if(5,33).</strong>
A == 5
a_equals_5
62&#62; <strong>tut9:test_if(33,6).</strong>
B == 6
b_equals_6
63&#62; <strong>tut9:test_if(2, 3).</strong>
A == 2, B == 3
a_equals_2_b_equals_3
64&#62; <strong>tut9:test_if(1, 33).</strong>
A == 1 ; B == 7
a_equals_1_or_b_equals_7
65&#62; <strong>tut9:test_if(33, 7).</strong>
A == 1 ; B == 7
a_equals_1_or_b_equals_7
66&#62; <strong>tut9:test_if(33, 33).</strong>
** exception error: no true branch found when evaluating an if expression
     in function  tut9:test_if/2
</pre></div>

<p>Notice that <span class="code">tut9:test_if(33,33)</span> did not cause any
condition to succeed so we got the run time error
<span class="code">if_clause</span>, here nicely formatted by the shell. See the chapter
<a href="javascript:erlhref('../../', 'doc/reference_manual', 'expressions.html');">&#34;Guard Sequences&#34;</a> in the Erlang Reference Manual for details
of the many guard tests available. <span class="code">case</span> is another
construct in Erlang. Recall that we wrote the
<span class="code">convert_length</span> function as:
</p>
<div class="example"><pre>
convert_length({centimeter, X}) -&#62;
    {inch, X / 2.54};
convert_length({inch, Y}) -&#62;
    {centimeter, Y * 2.54}.
</pre></div>

<p>We could also write the same program as:
</p>
<div class="example"><pre>
-module(tut10).
-export([convert_length/1]).

convert_length(Length) -&#62;
    case Length of
        {centimeter, X} -&#62;
            {inch, X / 2.54};
        {inch, Y} -&#62;
            {centimeter, Y * 2.54}
    end.
</pre></div>

<div class="example"><pre>
67&#62; <strong>c(tut10).</strong>
{ok,tut10}
68&#62; <strong>tut10:convert_length({inch, 6}).</strong>
{centimeter,15.24}
69&#62; <strong>tut10:convert_length({centimeter, 2.5}).</strong>
{inch,0.984251968503937}
</pre></div>

<p>Notice that both <span class="code">case</span> and <span class="code">if</span> have <strong>return values</strong>, i.e. in the above example <span class="code">case</span> returned
either <span class="code">{inch,X/2.54}</span> or <span class="code">{centimeter,Y*2.54}</span>.
The behaviour of <span class="code">case</span> can also be modified by using guards.
An example should hopefully clarify this. The following example
tells us the length of a month, given the year. We need to know
the year of course, since February has 29 days in a leap year.
</p>
<div class="example"><pre>
-module(tut11).
-export([month_length/2]).

month_length(Year, Month) -&#62;
    %% All years divisible by 400 are leap
    %% Years divisible by 100 are not leap (except the 400 rule above)
    %% Years divisible by 4 are leap (except the 100 rule above)
    Leap = if
        trunc(Year / 400) * 400 == Year -&#62;
            leap;
        trunc(Year / 100) * 100 == Year -&#62;
            not_leap;
        trunc(Year / 4) * 4 == Year -&#62;
            leap;
        true -&#62;
            not_leap
    end,  
    case Month of
        sep -&#62; 30;
        apr -&#62; 30;
        jun -&#62; 30;
        nov -&#62; 30;
        feb when Leap == leap -&#62; 29;
        feb -&#62; 28;
        jan -&#62; 31;
        mar -&#62; 31;
        may -&#62; 31;
        jul -&#62; 31;
        aug -&#62; 31;
        oct -&#62; 31;
        dec -&#62; 31
    end.
</pre></div>

<div class="example"><pre>
70&#62; <strong>c(tut11).</strong>
{ok,tut11}
71&#62; <strong>tut11:month_length(2004, feb).</strong>
29
72&#62; <strong>tut11:month_length(2003, feb).</strong>
28
73&#62; <strong>tut11:month_length(1947, aug).</strong>
31
</pre></div>
<a name="2.12"><!-- Empty --></a>
<h3>2.12 Built In Functions (BIFs)</h3>

<p>Built in functions BIFs are functions which for some reason is
built in to the Erlang virtual machine. BIFs often implement 
functionality that is impossible to implement in Erlang or is to
inefficient to implement in Erlang. Some BIFs can be called 
by use of the function name only but they are by default belonging
to the erlang module so for example the call to the BIF <span class="code">trunc</span>
below is equivalent with a call to <span class="code">erlang:trunc</span>.
</p>
<p>As you can see, we first find out if a year is leap or not. If a
year is divisible by 400, it is a leap year. To find this out we
first divide the year by 400 and use the built in function
<span class="code">trunc</span> (more later) to cut off any decimals. We then
multiply by 400 again and see if we get back the same value. For
example, year 2004:
</p>
<div class="example"><pre>
2004 / 400 = 5.01
trunc(5.01) = 5
5 * 400 = 2000
</pre></div>

<p>and we can see that we got back 2000 which is not the same as
2004, so 2004 isn't divisible by 400. Year 2000:
</p>
<div class="example"><pre>
2000 / 400 = 5.0
trunc(5.0) = 5
5 * 400 = 2000
</pre></div>

<p>so we have a leap year. The next two tests if the year is
divisible by 100 or 4 are done in the same way. The first
<span class="code">if</span> returns <span class="code">leap</span> or <span class="code">not_leap</span> which lands up
in the variable <span class="code">Leap</span>. We use this variable in the guard
for <span class="code">feb</span> in the following <span class="code">case</span> which tells us how
long the month is.
</p>
<p>This example showed the use of <span class="code">trunc</span>, an easier way would
be to use the Erlang operator <span class="code">rem</span> which gives the remainder
after division. For example:
</p>
<div class="example"><pre>
74&#62; <strong>2004 rem 400.</strong>
4
</pre></div>

<p>so instead of writing
</p>
<div class="example"><pre>
trunc(Year / 400) * 400 == Year -&#62;
    leap;
</pre></div>

<p>we could write
</p>
<div class="example"><pre>
Year rem 400 == 0 -&#62;
    leap;
</pre></div>

<p>There are many other built in functions (BIF) such as
<span class="code">trunc</span>. Only a few built in functions can be used in guards,
and you cannot use functions you have defined yourself in guards.
(see the chapter
<a href="javascript:erlhref('../../', 'doc/reference_manual', 'expressions.html');">&#34;Guard Sequences&#34;</a> in the Erlang Reference Manual) (Aside for
advanced readers: This is to ensure that guards don't have side
effects). Let's play with a few of these functions in the shell:
</p>
<div class="example"><pre>
75&#62; <strong>trunc(5.6).</strong>
5
76&#62; <strong>round(5.6).</strong>
6
77&#62; <strong>length([a,b,c,d]).</strong>
4
78&#62; <strong>float(5).</strong>
5.0
79&#62; <strong>is_atom(hello).</strong>
true
80&#62; <strong>is_atom(&#34;hello&#34;).</strong>
false
81&#62; <strong>is_tuple({paris, {c, 30}}).</strong>
true
82&#62; <strong>is_tuple([paris, {c, 30}]).</strong>
false
</pre></div>

<p>All the above can be used in guards. Now for some which can't be
used in guards:
</p>
<div class="example"><pre>
83&#62; <strong>atom_to_list(hello).</strong>
&#34;hello&#34;
84&#62; <strong>list_to_atom(&#34;goodbye&#34;).</strong>
goodbye
85&#62; <strong>integer_to_list(22).</strong>
&#34;22&#34;
</pre></div>

<p>The 3 BIFs above do conversions which would be difficult (or
impossible) to do in Erlang.
</p><a name="2.13"><!-- Empty --></a>
<h3>2.13 Higher Order Functions (Funs)</h3>

<p>Erlang, like most modern functional programming languages, has
higher order functions. We start with an example using the shell:
</p>
<div class="example"><pre>
86&#62; <strong>Xf = fun(X) -&#62; X * 2 end.</strong>
#Fun&#60;erl_eval.5.123085357&#62;
87&#62; <strong>Xf(5).</strong>
10
</pre></div>

<p>What we have done here is to define a function which doubles
the value of number and assign this function to a variable. Thus
<span class="code">Xf(5)</span> returned the value 10. Two useful functions when
working with lists are <span class="code">foreach</span> and <span class="code">map</span>, which are
defined as follows:
</p>
<div class="example"><pre>
foreach(Fun, [First|Rest]) -&#62;
    Fun(First),
    foreach(Fun, Rest);
foreach(Fun, []) -&#62;
    ok.

map(Fun, [First|Rest]) -&#62; 
    [Fun(First)|map(Fun,Rest)];
map(Fun, []) -&#62; 
    [].
</pre></div>

<p>These two functions are provided in the standard module
<span class="code">lists</span>. <span class="code">foreach</span> takes a list and applies a fun to
every element in the list, <span class="code">map</span> creates a new list by
applying a fun to every element in a list. Going back to
the shell, we start by using <span class="code">map</span> and a fun to add 3 to
every element of a list:
</p>
<div class="example"><pre>
88&#62; <strong>Add_3 = fun(X) -&#62; X + 3 end.</strong>
#Fun&#60;erl_eval.5.123085357&#62;
89&#62; <strong>lists:map(Add_3, [1,2,3]).</strong>
[4,5,6]
</pre></div>

<p>Now lets print out the temperatures in a list of cities (yet
again):
</p>
<div class="example"><pre>
90&#62; <strong>Print_City = fun({City, {X, Temp}}) -&#62; io:format(&#34;~-15w ~w ~w~n&#34;,</strong>
<strong>[City, X, Temp]) end.</strong>
#Fun&#60;erl_eval.5.123085357&#62;
91&#62; <strong>lists:foreach(Print_City, [{moscow, {c, -10}}, {cape_town, {f, 70}},</strong>
<strong>{stockholm, {c, -4}}, {paris, {f, 28}}, {london, {f, 36}}]).</strong>
moscow          c -10
cape_town       f 70
stockholm       c -4
paris           f 28
london          f 36
ok
</pre></div>

<p>We will now define a fun which can be used to go through a list
of cities and temperatures and transform them all to Celsius.
</p>
<div class="example"><pre>
-module(tut13).

-export([convert_list_to_c/1]).

convert_to_c({Name, {f, Temp}}) -&#62;
    {Name, {c, trunc((Temp - 32) * 5 / 9)}};
convert_to_c({Name, {c, Temp}}) -&#62;
    {Name, {c, Temp}}.

convert_list_to_c(List) -&#62;
    lists:map(fun convert_to_c/1, List).
</pre></div>

<div class="example"><pre>
92&#62; <strong>tut13:convert_list_to_c([{moscow, {c, -10}}, {cape_town, {f, 70}},</strong>
<strong>{stockholm, {c, -4}}, {paris, {f, 28}}, {london, {f, 36}}]).</strong>
[{moscow,{c,-10}},
 {cape_town,{c,21}},
 {stockholm,{c,-4}},
 {paris,{c,-2}},
 {london,{c,2}}]
</pre></div>

<p>The <span class="code">convert_to_c</span> function is the same as before, but we
use it as a fun:
</p>
<div class="example"><pre>
lists:map(fun convert_to_c/1, List)
</pre></div>

<p>When we use a function defined elsewhere as a fun we can refer
to it as <span class="code">Function/Arity</span> (remember that <span class="code">Arity</span> =
number of arguments). So in the <span class="code">map</span> call we write
<span class="code">lists:map(fun convert_to_c/1, List)</span>. As you can see
<span class="code">convert_list_to_c</span> becomes much shorter and easier to
understand.
</p>
<p>The standard module <span class="code">lists</span> also contains a function
<span class="code">sort(Fun, List)</span> where <span class="code">Fun</span> is a fun with two
arguments. This fun should return <span class="code">true</span> if the the first
argument is less than the second argument, or else <span class="code">false</span>.
We add sorting to the <span class="code">convert_list_to_c</span>:
</p>
<div class="example"><pre>
-module(tut13).

-export([convert_list_to_c/1]).

convert_to_c({Name, {f, Temp}}) -&#62;
    {Name, {c, trunc((Temp - 32) * 5 / 9)}};
convert_to_c({Name, {c, Temp}}) -&#62;
    {Name, {c, Temp}}.

convert_list_to_c(List) -&#62;
    New_list = lists:map(fun convert_to_c/1, List),
    lists:sort(fun({_, {c, Temp1}}, {_, {c, Temp2}}) -&#62;
                       Temp1 &#60; Temp2 end, New_list).
</pre></div>

<div class="example"><pre>
93&#62; <strong>c(tut13).</strong>
{ok,tut13}
94&#62; <strong>tut13:convert_list_to_c([{moscow, {c, -10}}, {cape_town, {f, 70}},</strong>
<strong>{stockholm, {c, -4}}, {paris, {f, 28}}, {london, {f, 36}}]).</strong>
[{moscow,{c,-10}},
 {stockholm,{c,-4}},
 {paris,{c,-2}},
 {london,{c,2}},
 {cape_town,{c,21}}]
</pre></div>

<p>In <span class="code">sort</span> we use the fun:
</p>
<div class="example"><pre>
fun({_, {c, Temp1}}, {_, {c, Temp2}}) -&#62; Temp1 &#60; Temp2 end,
</pre></div>

<p>Here we introduce the concept of an <strong>anonymous variable</strong>
&#34;_&#34;. This is simply shorthand for a variable which is going to
get a value, but we will ignore the value. This can be used
anywhere suitable, not just in fun's. <span class="code">Temp1 &#60; Temp2</span>
returns <span class="code">true</span> if <span class="code">Temp1</span> is less than <span class="code">Temp2</span>.
</p><center>
<hr/>
<small>
  Copyright &copy; 1991-2008
  <a href="http://www.ericsson.com/technology/opensource/erlang">Ericsson AB</a><br/ >
</small>
</center></body>
</html>
